<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ“Š LSA Tool (Static Front)</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto; background:#0f1117; color:#e5e7eb; margin:0; padding:2rem;}
    .wrap{max-width:820px; margin:0 auto;}
    input,select,button{padding:10px 12px; border-radius:10px; border:1px solid #334155; background:#111827; color:#e5e7eb;}
    .row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;}
    .card{background:#111827; border:1px solid #334155; border-radius:16px; padding:16px; margin-top:16px;}
    .muted{color:#9ca3af; font-size:13px}
    pre{white-space:pre-wrap; background:#0b1220; padding:12px; border-radius:12px; overflow:auto;}
    .badge{padding:4px 10px; border-radius:999px; font-size:12px; margin-left:6px; background:#334155;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ“Š LSA Tool</h1>
    <p class="muted">ë¶„ì„ìš© APIë¥¼ ë³„ë„ ì„œë²„ë¡œ ì˜¬ë¦° ë’¤, ì—¬ê¸°ëŠ” ì •ì  í”„ë¡ íŠ¸ì—ì„œ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>

    <div class="card">
      <div class="row">
        <input id="ticker" placeholder="ì˜ˆ: AAPL / 005930.KS / 7203.T" style="flex:1"/>
        <select id="lang">
          <option value="ko">í•œêµ­ì–´</option>
          <option value="en">English</option>
        </select>
        <button id="go">ğŸ” Analyse</button>
      </div>
      <p class="muted">KR/JP/HK ì¢…ëª©ì€ .KS / .T / .HK ì ‘ë¯¸ì‚¬ í•„ìˆ˜</p>
    </div>

    <div id="out" class="card" style="display:none">
      <h2 id="title">ê²°ê³¼</h2>
      <div id="meta" class="muted"></div>

      <h3>ğŸ“ Narrative</h3>
      <div id="narr"></div>

      <details style="margin-top:12px">
        <summary>Raw JSON</summary>
        <pre id="raw"></pre>
      </details>
    </div>
  </div>

  <script>
    // ğŸ”§ ë°°í¬ í›„ ë‹¹ì‹ ì˜ API URLë¡œ êµì²´í•˜ì„¸ìš”
    const API_BASE = "https://lsa-tool-api.onrender.com";

    const $ = (s)=>document.querySelector(s);
    const goBtn = $("#go");
    const out = $("#out");
    const title = $("#title");
    const meta = $("#meta");
    const narr = $("#narr");
    const raw = $("#raw");

    goBtn.addEventListener("click", async ()=>{
      const t = $("#ticker").value.trim().toUpperCase();
      const lang = $("#lang").value;
      if(!t){ alert("í‹°ì»¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

      goBtn.disabled = true; goBtn.textContent = "â³ Analyzing...";
      narr.textContent = ""; raw.textContent=""; meta.textContent="";
      try{
        const body = { query: `${t} ìœ ë™ì„±/ê±´ì „ì„± í‰ê°€`, language: lang };
        const res = await fetch(`${API_BASE}/analyse`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(body)
        });
        if(!res.ok){ throw new Error(`HTTP ${res.status}`); }
        const data = await res.json();

        title.textContent = `${(data.core?.company)||"-"} (${(data.core?.ticker)||"-"})`;
        meta.textContent  = `Last Price: ${data.core?.price ?? "N/A"}`;
        // LLMì´ ë§Œë“¤ì–´ì¤€ Markdownì´ë¯€ë¡œ ê°„ë‹¨ ë Œë”(ì•„ë˜ëŠ” ë§¤ìš° ë‹¨ìˆœ)
        // í•„ìš”í•˜ë©´ marked.js ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê¹”ë” ë Œë”í•˜ì„¸ìš”.
        narr.innerText = data.explanation || "â€”";
        raw.textContent = JSON.stringify(data, null, 2);

        out.style.display = "block";
      }catch(e){
        alert("ë¶„ì„ ì‹¤íŒ¨: " + e.message);
      }finally{
        goBtn.disabled = false; goBtn.textContent = "ğŸ” Analyse";
      }
    });
  </script>
</body>
</html>
