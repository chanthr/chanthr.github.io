<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>📊 LSA Tool (Static Front)</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto; background:#0f1117; color:#e5e7eb; margin:0; padding:2rem;}
    .wrap{max-width:820px; margin:0 auto;}
    input,select,button{padding:10px 12px; border-radius:10px; border:1px solid #334155; background:#111827; color:#e5e7eb;}
    .row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;}
    .card{background:#111827; border:1px solid #334155; border-radius:16px; padding:16px; margin-top:16px;}
    .muted{color:#9ca3af; font-size:13px}
    pre{white-space:pre-wrap; background:#0b1220; padding:12px; border-radius:12px; overflow:auto;}
    .badge{padding:4px 10px; border-radius:999px; font-size:12px; margin-left:6px; background:#334155;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>📊 LSA Tool</h1>
    <p class="muted">분석용 API를 별도 서버로 올린 뒤, 여기는 정적 프론트에서 호출합니다.</p>

    <div class="card">
      <div class="row">
        <input id="ticker" placeholder="예: AAPL / 005930.KS / 7203.T" style="flex:1"/>
        <select id="lang">
          <option value="ko">한국어</option>
          <option value="en">English</option>
        </select>
        <button id="go">🔎 Analyse</button>
      </div>
      <p class="muted">KR/JP/HK 종목은 .KS / .T / .HK 접미사 필수</p>
    </div>

    <div id="out" class="card" style="display:none">
      <h2 id="title">결과</h2>
      <div id="meta" class="muted"></div>

      <h3>📝 Narrative</h3>
      <div id="narr"></div>

      <details style="margin-top:12px">
        <summary>Raw JSON</summary>
        <pre id="raw"></pre>
      </details>
    </div>
  </div>

  <script>
    // 🔧 배포 후 당신의 API URL로 교체하세요
    const API_BASE = "https://lsa-tool-api.onrender.com";

    const $ = (s)=>document.querySelector(s);
    const goBtn = $("#go");
    const out = $("#out");
    const title = $("#title");
    const meta = $("#meta");
    const narr = $("#narr");
    const raw = $("#raw");

    goBtn.addEventListener("click", async ()=>{
      const t = $("#ticker").value.trim().toUpperCase();
      const lang = $("#lang").value;
      if(!t){ alert("티커를 입력하세요."); return; }

      goBtn.disabled = true; goBtn.textContent = "⏳ Analyzing...";
      narr.textContent = ""; raw.textContent=""; meta.textContent="";
      try{
        const body = { query: `${t} 유동성/건전성 평가`, language: lang };
        const res = await fetch(`${API_BASE}/analyse`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(body)
        });
        if(!res.ok){ throw new Error(`HTTP ${res.status}`); }
        const data = await res.json();

        title.textContent = `${(data.core?.company)||"-"} (${(data.core?.ticker)||"-"})`;
        meta.textContent  = `Last Price: ${data.core?.price ?? "N/A"}`;
        // LLM이 만들어준 Markdown이므로 간단 렌더(아래는 매우 단순)
        // 필요하면 marked.js 같은 라이브러리로 깔끔 렌더하세요.
        narr.innerText = data.explanation || "—";
        raw.textContent = JSON.stringify(data, null, 2);

        out.style.display = "block";
      }catch(e){
        alert("분석 실패: " + e.message);
      }finally{
        goBtn.disabled = false; goBtn.textContent = "🔎 Analyse";
      }
    });
  </script>
</body>
</html>
